"use strict";/*jshint smarttabs:true*/
/*jshint expr:true */
var validationCallback={checkField:function(a){var b=$("#"+a.id);xsd.checkField(b),validation.checkRequired(b),validation.processField(b)}},datePicker={init:function(){datePickerController.setGlobalOptions({
//No auto replace of dates
dateparsefallback:!1,nodrag:1}),this.bindUIActions()},bindUIActions:function(){var a=$(".skts-date-picker"),b=$(".js-date-picker-with-range"),c=$("#sktsCurrentYear");
//Set the date picker for fixed year fields
if(
//Set the standard date picker
a.length>0&&a.each(function(){datePicker.create(this,"01-01-1900","01-01-2100")}),
//Set the date picker for an interval
b.length>0&&
//Set the datepicker with an interval
b.each(function(){var a=$(this),b=a.attr("data-calendar-start-date"),c=a.attr("data-calendar-end-date"),d=a.attr("data-calendar-cursor-start-date");void 0!==d?datePicker.create(this,b,c,d):datePicker.create(this,b,c)}),c.length>0&&""!==c.val()){var d=c.val();
//Set the date picker for a fixed year
$(".js-date-picker-fixed-year").each(function(){var a="01-01-"+d,b="31-12-"+d,c="01-01-"+d;datePicker.create(this,a,b,c)}),
//Set the date picker for a fixed START year (end year is the default - 2100)
$(".js-date-picker-fixed-start-year").each(function(){var a="01-01-"+d,b="01-01-2100",c="01-01-"+d;datePicker.create(this,a,b,c)})}},create:function(a,b,c,d){var e=$(a).attr("id"),f={};if(
//Create the datepicker
$(this).attr("maxlength","10"),f[e]="%d-%m-%Y",datePickerController.createDatePicker({formElements:f,highlightDays:[0,0,0,0,0,0,0],//Do not highlight any days
callbackFunctions:{datereturned:[validationCallback.checkField],//Check the date format after select
redraw:[datePicker.scrollTop]}}),b){var g=helper.convertToDate(b);datePickerController.setRangeLow(e,g)}if(c){var h=helper.convertToDate(c);datePickerController.setRangeHigh(e,h)}if(d){var i=helper.convertToDate(d);datePickerController.setCursorDate(e,i)}},destroy:function(a){datePickerController.destroyDatePicker(a)},destroyAll:function(){$(".skts-date-picker, .js-date-picker-fixed-year, .js-date-picker-fixed-start-year, .js-date-picker-with-range").each(function(){datePicker.destroy($(this).attr("id"))})},scrollTop:function(a){setTimeout(function(){window.scrollTo(0,$("#fd-"+a.id).offset().top)},0)}};$(document).ready(function(){datePicker.init()});/*! DatePicker language - DANISH*/
var fdLocale={fullMonths:["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],monthAbbrs:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],fullDays:["Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag","Søndag"],dayAbbrs:["Man","Tir","Ons","Tor","Fre","Lør","Søn"],titles:["Forrige måned","Næste måned","Forrig år","Næste år","I dag","Vis kalender","uge","Uge [[%0%]] af [[%1%]]","Uge","Vælg en dato","Klik & Træk for at flytte","Vis “[[%0%]]” Først","Gå til dags dato","Deaktiveret dato"]};try{"datePickerController"in window&&datePickerController.loadLanguage()}catch(err){}/*! DatePicker v6.3.6 MIT/GPL2 @freqdec */
var datePickerController=function a(){function b(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function c(a,b){new RegExp("(^|["+W+"])"+b+"(["+W+"]|$)").test(a.className)||(a.className+=(a.className?" ":"")+b)}function d(a,b){a.className=b?a.className.replace(new RegExp("(^|["+W+"])"+b+"(["+W+"]|$)")," ").replace(new RegExp("/^["+W+"]["+W+"]*/"),"").replace(new RegExp("/["+W+"]["+W+"]*$/"),""):""}
// Attempts to parse the current language from the HTML element. Defaults to "en" if none given
function e(){var a=document.getElementsByTagName("html")[0].getAttribute("lang")||document.getElementsByTagName("html")[0].getAttribute("xml:lang");return a=a?a.toLowerCase():"en",a.search(/^([a-z]{2,3})-([a-z]{2})$/)!=-1?[a.match(/^([a-z]{2,3})-([a-z]{2})$/)[1],a]:[a]}
// Affects the JSON passed to the script
function f(a){if("object"==typeof a){var b,c={debug:function(a){return r=!!a,!0},lang:function(a){return"string"==typeof a&&a.search(/^[a-z]{2,3}(-([a-z]{2}))?$/i)!=-1&&(u=[a.toLowerCase()],I=!0,E=!0),!0},nodrag:function(a){return G=!!a,!0},buttontabindex:function(a){return C=!!a,!0},derivelocale:function(a){return E=!!a,!0},mousewheel:function(a){return D=!!a,!0},cellformat:function(a){return"string"==typeof a&&h(a),!0},titleformat:function(a){return"string"==typeof a&&(L=a),!0},statusformat:function(a){return"string"==typeof a&&(M=a),!0},describedby:function(a){return"string"==typeof a&&(t=a),!0},finalopacity:function(a){return"number"==typeof a&&+a>20&&+a<=100&&(z=parseInt(a,10)),!0},bespoketitles:function(a){if("object"==typeof a){y={};for(var b in a)a.hasOwnProperty(b)&&String(b).match(V)!=-1&&(y[b]=String(a[b]))}return!0},dateparsefallback:function(a){return J=!!a,!0},languagefilelocation:function(a){return H=a,!0},_default:function(){if(r)throw"Unknown key located within JSON data: "+b;return!0}};for(b in a)a.hasOwnProperty(b)&&(c.hasOwnProperty(String(b).toLowerCase())&&c[String(b).toLowerCase()]||c._default)(a[b])}}
// Parses the JSON passed either between the script tags or by using the
// setGlobalOptions method
function g(a){if("string"!=typeof a||""==a)return{};try{
// Does a JSON (native or not) Object exist
if("object"==typeof JSON&&JSON.parse)return window.JSON.parse(a);if(/debug|lang|nodrag|buttontabindex|derivelocale|mousewheel|cellformat|titleformat|statusformat|describedby|finalopacity|bespoketitles|dateparsefallback/.test(a.toLowerCase())){var b=Function(["var document,top,self,window,parent,Number,Date,Object,Function,","Array,String,Math,RegExp,Image,ActiveXObject;","return (",a.replace(/<\!--.+-->/gim,"").replace(/\bfunction\b/g,"function-"),");"].join(""));return b()}}catch(c){}if(r)throw"Could not parse the JSON object";return{err:1}}
// Parses the cell format to use whenever the datepicker has keyboard focus
function h(a){
// Don't use hidden text for opera due to the default
// "blue" browser focus outline stretching outside of the viewport
// and degrading visual accessibility. Harsh & hackish though...
// If no day part stipulated then use presets
// Basic split on the %j or %d modifiers
return s?(N=["%j"],void(K="%j %F %Y")):void(a.match(/%([d|j])/)!=-1&&(N=Y(a,/%([d|j])/),K=a))}function i(a,b){return b=Math.min(4,b||2),"0000".substr(0,b-Math.min(String(a).length,b))+a}
// Very, very basic event functions
function j(a,b,c){a.addEventListener?a.addEventListener(b,c,!0):a.attachEvent&&a.attachEvent("on"+b,c)}function k(a,b,c){try{a.removeEventListener?a.removeEventListener(b,c,!0):a.detachEvent&&a.detachEvent("on"+b,c)}catch(d){}}function l(a){return a=a||document.parentWindow.event,a.stopPropagation&&(a.stopPropagation(),a.preventDefault()),X&&(a.cancelBubble=!0,a.returnValue=!1),!1}function m(a,b){a&&a.tagName&&a.setAttribute("role",b)}function n(a,b,c){a&&a.tagName&&a.setAttribute("aria-"+b,c)}
// Sets a tabindex attribute on an element, bends over for IE.
function o(a,b){a.setAttribute(X?"tabIndex":"tabindex",b),a.tabIndex=b}function p(a){return a instanceof Date&&!isNaN(a)?a.getFullYear()+i(a.getMonth()+1)+""+i(a.getDate()):a}
// The datePicker object itself
function q(a){this.dateSet=null,this.timerSet=!1,this.visible=!1,this.fadeTimer=null,this.timer=null,this.yearInc=0,this.monthInc=0,this.dayInc=0,this.mx=0,this.my=0,this.x=0,this.y=0,this.created=!1,this.disabled=!1,this.opacity=0,this.opacityTo=100,this.finalOpacity=100,this.inUpdate=!1,this.kbEventsAdded=!1,this.fullCreate=!1,this.selectedTD=null,this.cursorTD=null,this.cursorDate=a.cursorDate?a.cursorDate:"",this.date=a.cursorDate?new Date((+a.cursorDate.substr(0,4)),+a.cursorDate.substr(4,2)-1,(+a.cursorDate.substr(6,2)),5,0,0):new Date,this.defaults={},this.dynDisabledDates={},this.dateList=[],this.bespokeClass=a.bespokeClass,this.firstDayOfWeek=F.firstDayOfWeek,this.interval=new Date,this.clickActivated=!1,this.showCursor=!1,this.noFocus=!0,this.kbEvent=!1,this.delayedUpdate=!1,this.bespokeTitles={},this.bespokeTabIndex=a.bespokeTabIndex;for(var e in a)a.hasOwnProperty(e)&&String(e).search(/^(callbacks|formElements|enabledDates|disabledDates)$/)==-1&&(this[e]=a[e]);X&&(this.iePopUp=null);for(var f,g=0;f=["callbacks","formElements"][g];g++)if(this[f]={},f in a)for(e in a[f])a[f].hasOwnProperty(e)&&(this[f][e]=a[f][e]);
// Adjust time to stop daylight savings madness on windows
this.date.setHours(5),
// Called from an associated form elements onchange event
this.changeHandler=function(){
// In a perfect world this shouldn't ever happen
h.disabled||(h.setDateFromInput(),h.callback("dateset",h.createCbArgObj()))},
// Creates the object passed to the callback functions
this.createCbArgObj=function(){return this.dateSet?{id:this.id,date:this.dateSet,dd:i(this.date.getDate()),mm:i(this.date.getMonth()+1),yyyy:this.date.getFullYear()}:{id:this.id,date:null,dd:null,mm:null,yyyy:null}},
// Attempts to grab the window scroll offsets
this.getScrollOffsets=function(){return"number"==typeof window.pageYOffset?[window.pageXOffset,window.pageYOffset]:document.body&&(document.body.scrollLeft||document.body.scrollTop)?[document.body.scrollLeft,document.body.scrollTop]:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[0,0]},
// Calculates the current list of disabled & enabled dates for a specific year/month
this.getDateExceptions=function(a,b){b=i(b);var c,d,e,f,g,j,k,l,m,n,o,p={},q=h.firstDateShown,r=h.lastDateShown,s=h.dateList.length;for(r&&q||(q=h.firstDateShown=a+i(b)+"01",r=h.lastDateShown=a+i(b)+i(ha(b,a))),g=Number(q.substr(0,6)),j=Number(r.substr(0,6)),d=String(g);+d<=j;){for(e=d.substr(0,4),f=d.substr(4,2),c=0;c<s;c++)
// Single date
if(l=String(h.dateList[c].rLow).replace(/^(\*\*\*\*)/,e).replace(/^(\d\d\d\d)(\*\*)/,"$1"+f),m=String(h.dateList[c].rHigh).replace(/^(\*\*\*\*)/,e).replace(/^(\d\d\d\d)(\*\*)/,"$1"+f),1!=m){
// Date Range
if(l<=m&&d>=l.substr(0,6)&&d<=m.substr(0,6))for(n=Math.max(l,Math.max(String(d)+"01",this.firstDateShown)),o=Math.min(m,Math.min(String(d)+"31",this.lastDateShown)),k=n;k<=o;k++)p[k]=h.dateList[c].type}else+l>=+h.firstDateShown&&+l<=+h.lastDateShown&&(p[l]=h.dateList[c].type);
// Let the Date Object take care of month overflowss
d=new Date(e,(+f),2),d=d.getFullYear()+""+i(d.getMonth()+1)}return p},
// Repositions the datepicker beside the button - to the bottom by
// preference but to the top if there is not enough room to display the
// entire U.I. at the bottom (it really should be updated to favour
// bottom positioning if not enough room to display the entire U.I. at
// the top in that scenario though)
this.reposition=function(){if(h.created&&!h.staticPos){h.div.style.visibility="hidden",h.div.style.left=h.div.style.top="0px",h.div.style.display="block";var a=h.div.offsetHeight,b=h.div.offsetWidth,c=document.getElementById("fd-but-"+h.id),d=h.truePosition(c),e=document.compatMode&&"BackCompat"!=document.compatMode?document.documentElement:document.body,f=h.getScrollOffsets(),g=f[1],i=f[0],j=parseInt(d[1]-2)-parseInt(g),k=parseInt(e.clientHeight+g)-parseInt(d[1]+c.offsetHeight+2);h.div.style.visibility="visible",h.div.style.left=Number(parseInt(e.clientWidth+i)<parseInt(b+d[0])?Math.abs(parseInt(e.clientWidth+i-b)):d[0])+"px",h.div.style.top=k>j?Math.abs(parseInt(d[1]+c.offsetHeight+2))+"px":Math.abs(parseInt(d[1]-(a+2)))+"px",6===X&&(h.iePopUp.style.top=h.div.style.top,h.iePopUp.style.left=h.div.style.left,h.iePopUp.style.width=b+"px",h.iePopUp.style.height=a-2+"px")}},this.removeCursorHighlight=function(){var a=document.getElementById(h.id+"-date-picker-hover");a&&d(a,"date-picker-hover")},this.addCursorHighlight=function(){var a=document.getElementById(h.id+"-date-picker-hover");a&&c(a,"date-picker-hover")},
// Resets the tabindex of the previously focused cell
this.removeOldFocus=function(){var a=document.getElementById(h.id+"-date-picker-hover");if(a)try{o(a,-1),d(a,"date-picker-hover"),a.id="",a.onblur=null,a.onfocus=null}catch(b){}},
// Sets the tabindex & focus on the currently highlighted cell
this.setNewFocus=function(){var a=document.getElementById(h.id+"-date-picker-hover");if(a)try{o(a,0),this.showCursor&&c(a,"date-picker-hover"),
// If opened with the keyboard then add focus & blur events to the cell
this.clickActivated||(a.onblur=h.onblur,a.onfocus=h.onfocus),
// If opened with the keyboard (and not in opera) then add a screen-reader friendly date format
s||this.clickActivated||h.addAccessibleDate(),
// Try to programmatically set focus on the cell
this.noFocus||this.clickActivated||setTimeout(function(){try{a.focus()}catch(b){}},0)}catch(b){}},
// Adds a screen-reader friendly date to the current cell whenever
// the datepicker has been opened with the keyboard
this.addAccessibleDate=function(){var a=document.getElementById(h.id+"-date-picker-hover");if(a&&!a.getElementsByTagName("span").length){var c,d=a.className.match(/cd-([\d]{4})([\d]{2})([\d]{2})/),e=a.className.search(R)!=-1,f=document.createElement("span");f.className="fd-screen-reader",b(a),e&&(c=f.cloneNode(!1),c.appendChild(document.createTextNode(ea(13))),a.appendChild(c));for(var g,i=0;g=N[i];i++)"%j"==g||"%d"==g?a.appendChild(document.createTextNode(ka(new Date(d[1],+d[2]-1,d[3],5,0,0),g,!0))):(c=f.cloneNode(!1),c.appendChild(document.createTextNode(ka(new Date(d[1],+d[2]-1,d[3],5,0,0),g,!0))),a.appendChild(c))}},
// Sets the current cursor to a specific date
this.setCursorDate=function(a){String(a).search(/^([0-9]{8})$/)!=-1&&(this.date=new Date((+a.substr(0,4)),+a.substr(4,2)-1,(+a.substr(6,2)),5,0,0),this.cursorDate=a,this.staticPos&&this.updateTable())},
// Updates the table used to display the datepicker
this.updateTable=function(a){if(h&&!h.inUpdate&&h.created){
// If the update timer initiated
if(
// We are currently updating (used to stop public methods from firing)
h.inUpdate=!0,
// Remove the focus from the currently highlighted cell
h.removeOldFocus(),h.div.dir=F.rtl?"rtl":"ltr",h.timerSet&&!h.delayedUpdate)
// Are we incrementing/decrementing the month
if(h.monthInc){var c=h.date.getDate(),d=new Date(h.date);d.setDate(2),d.setMonth(d.getMonth()+1*h.monthInc),
// Don't go over the days in the month
d.setDate(Math.min(c,ha(d.getMonth(),d.getFullYear()))),h.date=new Date(d)}else h.date.setDate(Math.min(h.date.getDate()+h.dayInc,ha(h.date.getMonth()+h.monthInc,h.date.getFullYear()+h.yearInc))),h.date.setMonth(h.date.getMonth()+h.monthInc),h.date.setFullYear(h.date.getFullYear()+h.yearInc);
// Make sure the internal date is within range
h.outOfRange(),
// Disable/enable the today button
h.noToday||h.disableTodayButton(),
// Disable/enable the month & year buttons
h.showHideButtons(h.date);var e=h.date.getDate(),f=h.date.getMonth(),g=h.date.getFullYear(),j=String(g)+i(f+1)+i(e),k=new Date(g,f,1,5,0,0);k.setHours(5);var l,m,o,p,q,r,s,t,u,w,x,y,z,
// Weekday of the fist of the month
A=(k.getDay()+6)%7,
// The column index this weekday will occupy
B=(A-h.firstDayOfWeek+7)%7-1,
// The number of days in the current month
C=ha(f,g),
// Today as a Date Object
D=new Date,
// Today as a YYYYMMDD String
D=D.getFullYear()+i(D.getMonth()+1)+i(D.getDate()),
// A Sring date stub in a YYYYMM format for the current date
E=String(k.getFullYear())+i(k.getMonth()+1),
//
s=[4,4,4,4,4,4],
// The first day of the previous month as a Date Object
G=new Date(g,f-1,1,5,0,0),
// The first day of the next month as a Date Object
H=new Date(g,f+1,1,5,0,0),
// The number of days in the previous month
I=ha(G.getMonth(),G.getFullYear()),
// YYYYMM String date stub for the next month
J=String(H.getFullYear())+i(H.getMonth()+1),
// YYYYMM String date stub for the previous month
K=String(G.getFullYear())+i(G.getMonth()+1),M=(H.getDay()+6)%7,N=(G.getDay()+6)%7,
// A SPAN node to clone when adding dates to individual cells
O=document.createElement("span");
// Give the "fd-screen-reader" class to the span in order to hide them in the UI
// but keep them accessible to screen-readers
O.className="fd-screen-reader",
// The first & last dates shown on the datepicker UI - could be a date from the previous & next month respectively
h.firstDateShown=!h.constrainSelection&&h.fillGrid&&0-B<1?String(K)+(I+(0-B)):E+"01",h.lastDateShown=!h.constrainSelection&&h.fillGrid?J+i(41-B-C):E+String(C),
// Store a reference to the current YYYYMM String representation of the current month
h.currentYYYYMM=E,u=h.callback("redraw",{id:h.id,dd:i(e),mm:i(f+1),yyyy:g,firstDateDisplayed:h.firstDateShown,lastDateDisplayed:h.lastDateShown})||{},
// An Object of dates that have been explicitly disabled (1) or enabled (0)
m=h.getDateExceptions(g,f+1),
// Double check current date within limits etc
h.checkSelectedDate(),
//
x=null!=h.dateSet&&h.dateSet.getFullYear()+i(h.dateSet.getMonth()+1)+i(h.dateSet.getDate()),
// If we have selected a date then set its ARIA selected property
// to false. We then set the ARIA selected property to true on the
// newly selected cell after redrawing the table
null!=this.selectedTD&&(n(this.selectedTD,"selected",!1),this.selectedTD=null);
// Redraw all of the table cells representing the date parts of the UI
for(var P=0;P<42;P++)
// Current row
p=Math.floor(P/7),
// Current TD node
q=h.tds[P],
// Clone our SPAN node
w=O.cloneNode(!1),
// Remove any previous contents from the cell
b(q),
// If the current cell contains a date
P>B&&P<=B+C||h.fillGrid?(t=E,z=A,l=P-B,o=[],y=!0,
// Are we drawing last month
l<1?(l=I+l,t=K,z=N,y=!h.constrainSelection,o.push("month-out")):l>C&&(l-=C,t=J,z=M,y=!h.constrainSelection,o.push("month-out")),
// Calcuate this cells weekday
z=(z+l+6)%7,
// Push a classname representing the weekday e.g. "day-3"
o.push("day-"+z+" cell-"+P),
// A YYYYMMDD String representation of this cells date
r=t+String(l<10?"0":"")+l,
// If this cells date is out of range
h.rangeLow&&+r<+h.rangeLow||h.rangeHigh&&+r>+h.rangeHigh?(
// Add a classname to style the cell and stop selection
q.className="out-of-range",
// Reset this TD nodes title attribute
q.title="",
// Append the cells date as a text node to the TD
q.appendChild(document.createTextNode(l)),
// Jaysus, what the feck does this line do again...
h.showWeeks&&(s[p]=Math.min(s[p],2))):(
// If it's a date from last or next month and the "constrainSelection" option
// is false then give the cell a CD-YYYYMMDD class
y?(q.title=L?ka(new Date((+String(t).substr(0,4)),+String(t).substr(4,2)-1,(+l),5,0,0),L,!0):"",o.push("cd-"+r+" yyyymmdd-"+r+" yyyymm-"+t+" mmdd-"+t.substr(4,2)+i(l))):(q.title=L?ea(13)+" "+ka(new Date((+String(t).substr(0,4)),+String(t).substr(4,2)-1,(+l),5,0,0),L,!0):"",o.push("yyyymmdd-"+r+" yyyymm-"+t+" mmdd-"+t.substr(4,2)+i(l)+" not-selectable")),
// Add a classname if the current cells date is today
r==D&&o.push("date-picker-today"),
// If this cell represents the currently selected date
x==r&&(
// Add a classname (for styling purposes)
o.push("date-picker-selected-date"),
// Set the ARIA selected property to true
n(q,"selected","true"),
// And cache a reference to the current cell
this.selectedTD=q),
// If the current cell has been explicitly disabled
(r in m&&1==m[r]||
// ... the current weekday has been disabled
h.disabledDays[z]&&
// ... and the current date has not been explicitly enabled
!(r in m&&0==m[r]))&&(
// Add a classname to style the cell and stop selection
o.push("day-disabled"),
// Update the current cells title to say "Disabled date: ..." (or whatever the translation says)
L&&y&&(q.title=ea(13)+" "+q.title)),
// Has the redraw callback given us a bespoke classname to add to this cell
r in u&&o.push(u[r]),
// Do we need to highlight this cells weekday representation
h.highlightDays[z]&&o.push("date-picker-highlight"),
// Is the current onscreen cursor set to this cells date
j==r&&(q.id=h.id+"-date-picker-hover"),
// Add the date to the TD cell as a text node. Note: If the datepicker has been given keyboard
// events, this textnode is replaced by a more screen-reader friendly date during the focus event
q.appendChild(document.createTextNode(l)),
// Add the classnames to the TD node
q.className=o.join(" "),
// If the UI displays week numbers then update the celladded
h.showWeeks&&(s[p]=Math.min("month-out"==o[0]?3:1,s[p])))):(
// Add a classname to style the cell
q.className="date-picker-unused",
// Add a non-breaking space to unused TD node (for IEs benefit mostly)
q.appendChild(document.createTextNode(v)),
// Reset the TD nodes title attribute
q.title=""),
// Do we update the week number for this row
h.showWeeks&&P-7*p==6&&(b(h.wkThs[p]),h.wkThs[p].appendChild(document.createTextNode(4!=s[p]||h.fillGrid?ja(g,f,P-B-6):v)),h.wkThs[p].className="date-picker-week-header"+["",""," out-of-range"," month-out",""][s[p]]);
// Update the UI title bar displaying the year & month
var Q=h.titleBar.getElementsByTagName("span");b(Q[0]),b(Q[1]),Q[0].appendChild(document.createTextNode(ga(f,!1)+v)),Q[1].appendChild(document.createTextNode(g)),
// If we are in an animation
h.timerSet&&(
// Speed the timer up a little bit to make the pause between updates quicker
h.timerInc=50+Math.round((h.timerInc-50)/1.8),
// Recall this function in a timeout
h.timer=window.setTimeout(h.updateTable,h.timerInc)),
// We are not currently updating the UI
h.inUpdate=h.delayedUpdate=!1,
// Focus on the correct TD node
h.setNewFocus()}},
// Removes all scaffold from the DOM & events from memory
this.destroy=function(){if(
// Remove the button if it exists
document.getElementById("fd-but-"+this.id)&&document.getElementById("fd-but-"+this.id).parentNode.removeChild(document.getElementById("fd-but-"+this.id)),this.created){if(
// Event cleanup for Internet Explorers benefit
k(this.table,"mousedown",h.onmousedown),k(this.table,"mouseover",h.onmouseover),k(this.table,"mouseout",h.onmouseout),k(document,"mousedown",h.onmousedown),k(document,"mouseup",h.clearTimer),window.addEventListener&&!window.devicePixelRatio)try{window.removeEventListener("DOMMouseScroll",this.onmousewheel,!1)}catch(a){}else k(document,"mousewheel",this.onmousewheel),k(window,"mousewheel",this.onmousewheel);if(h.removeOnFocusEvents(),clearTimeout(h.fadeTimer),clearTimeout(h.timer),6===X&&!h.staticPos)try{h.iePopUp.parentNode.removeChild(h.iePopUp),h.iePopUp=null}catch(a){}this.div&&this.div.parentNode&&this.div.parentNode.removeChild(this.div),h=null}},this.resizeInlineDiv=function(){h.div.style.width=h.table.offsetWidth+"px",h.div.style.height=h.table.offsetHeight+"px"},this.reset=function(){var a,b;for(a in h.formElements)b=document.getElementById(a),b&&("select"==b.tagName.toLowerCase()?b.selectedIndex=h.defaultVals[a]:b.value=h.defaultVals[a]);h.changeHandler()},
// Creates the DOM scaffold
this.create=function(){function a(a){var b=document.createElement("th");return a.thClassName&&(b.className=a.thClassName),a.colspan&&b.setAttribute(X?"colSpan":"colspan",a.colspan),b.unselectable="on",b}function b(b,c){for(var d,e=0;d=c[e];e++){var f=a(d);b.appendChild(f);var g=document.createElement("span");g.className=d.className,g.id=h.id+d.id,g.appendChild(document.createTextNode(d.text||h.nbsp)),g.title=d.title||"",g.unselectable="on",f.appendChild(g)}}if(!document.getElementById("fd-"+this.id)){var c,d,e,f,g,i;this.noFocus=!0,this.div=document.createElement("div"),this.div.id="fd-"+this.id,this.div.className="date-picker"+(A?" fd-dp-fade ":"")+this.bespokeClass,
// Attempt to hide the div from screen readers during content creation
this.div.style.visibility="hidden",this.div.style.display="none",
// Set the ARIA describedby property if the required block available
this.describedBy&&document.getElementById(this.describedBy)&&n(this.div,"describedby",this.describedBy),
// Set the ARIA labelled property if the required label available
this.labelledBy&&n(this.div,"labelledby",this.labelledBy.id),this.idiv=document.createElement("div"),this.table=document.createElement("table"),this.table.className="date-picker-table",this.table.onmouseover=this.onmouseover,this.table.onmouseout=this.onmouseout,this.table.onclick=this.onclick,this.finalOpacity<100&&(this.idiv.style.opacity=Math.min(Math.max(parseInt(this.finalOpacity,10)/100,.2),1)),this.staticPos&&(this.table.onmousedown=this.onmousedown),this.div.appendChild(this.idiv),this.idiv.appendChild(this.table);var j=this.dragDisabled?"":" drag-enabled";if(this.staticPos){var k=document.getElementById(this.positioned?this.positioned:this.id);if(!k){if(this.div=null,r)throw this.positioned?"Could not locate a datePickers associated parent element with an id:"+this.positioned:"Could not locate a datePickers associated input with an id:"+this.id;return}if(this.div.className+=" static-datepicker",this.positioned?k.appendChild(this.div):k.parentNode.insertBefore(this.div,k.nextSibling),this.hideInput)for(var l in this.formElements)k=document.getElementById(l),k&&(k.className+=" fd-hidden-input");setTimeout(this.resizeInlineDiv,300)}else this.div.style.visibility="hidden",this.div.className+=j,document.getElementsByTagName("body")[0].appendChild(this.div),6===X&&(this.iePopUp=document.createElement("iframe"),this.iePopUp.src="javascript:'<html></html>';",this.iePopUp.setAttribute("className","iehack"),
// Remove iFrame from tabIndex
this.iePopUp.setAttribute("tabIndex",-1),
// Hide it from ARIA aware technologies
m(this.iePopUp,"presentation"),n(this.iePopUp,"hidden","true"),this.iePopUp.scrolling="no",this.iePopUp.frameBorder="0",this.iePopUp.name=this.iePopUp.id=this.id+"-iePopUpHack",document.body.appendChild(this.iePopUp)),
// Aria "hidden" property for non active popup datepickers
n(this.div,"hidden","true");
// ARIA Application role
m(this.div,"application"),
//setARIARole(this.table, "grid");
this.statusFormat&&(i=document.createElement("tfoot"),this.table.appendChild(i),c=document.createElement("tr"),c.className="date-picker-tfoot",i.appendChild(c),this.statusBar=a({thClassName:"date-picker-statusbar"+j,colspan:this.showWeeks?8:7}),c.appendChild(this.statusBar),this.updateStatus()),f=document.createElement("thead"),f.className="date-picker-thead",this.table.appendChild(f),c=document.createElement("tr"),m(c,"presentation"),f.appendChild(c),
// Title Bar
this.titleBar=a({thClassName:"date-picker-title"+j,colspan:this.showWeeks?8:7}),c.appendChild(this.titleBar),c=null;var o=document.createElement("span");o.appendChild(document.createTextNode(v)),o.className="month-display"+j,this.titleBar.appendChild(o),o=document.createElement("span"),o.appendChild(document.createTextNode(v)),o.className="year-display"+j,this.titleBar.appendChild(o),o=null,c=document.createElement("tr"),m(c,"presentation"),f.appendChild(c),b(c,[{className:"prev-but prev-year",id:"-prev-year-but",text:"«",title:ea(2)},{className:"prev-but prev-month",id:"-prev-month-but",text:"‹",title:ea(0)},{colspan:this.showWeeks?4:3,className:"today-but",id:"-today-but",text:ea(4)},{className:"next-but next-month",id:"-next-month-but",text:"›",title:ea(1)},{className:"next-but next-year",id:"-next-year-but",text:"»",title:ea(3)}]),g=document.createElement("tbody"),this.table.appendChild(g);for(var p,q=this.showWeeks?8:7,s=this.showWeeks?0:-1,t=0;t<7;t++){d=document.createElement("tr"),0!=t?(
// ARIA Grid role
m(d,"row"),g.appendChild(d)):f.appendChild(d);for(var u=0;u<q;u++)0===t||this.showWeeks&&0===u?e=document.createElement("th"):(e=document.createElement("td"),n(e,"describedby",this.id+"-col-"+u+(this.showWeeks?" "+this.id+"-row-"+t:"")),n(e,"selected","false")),X&&(e.unselectable="on"),d.appendChild(e),this.showWeeks&&u>0&&t>0||!this.showWeeks&&t>0||(0===t&&u>s?(e.className="date-picker-day-header",e.scope="col",
//setARIARole(col, "columnheader");
e.id=this.id+"-col-"+u):(e.className="date-picker-week-header",e.scope="row",
//setARIARole(col, "rowheader");
e.id=this.id+"-row-"+t))}e=d=null,this.ths=this.table.getElementsByTagName("thead")[0].getElementsByTagName("tr")[2].getElementsByTagName("th");for(var w=0;w<q;w++)0==w&&this.showWeeks?(this.ths[w].appendChild(document.createTextNode(ea(6))),this.ths[w].title=ea(8)):w>(this.showWeeks?0:-1)&&(p=document.createElement("span"),p.className="fd-day-header",X&&(p.unselectable="on"),this.ths[w].appendChild(p));p=null,this.trs=this.table.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),this.tds=this.table.getElementsByTagName("tbody")[0].getElementsByTagName("td"),this.butPrevYear=document.getElementById(this.id+"-prev-year-but"),this.butPrevMonth=document.getElementById(this.id+"-prev-month-but"),this.butToday=document.getElementById(this.id+"-today-but"),this.butNextYear=document.getElementById(this.id+"-next-year-but"),this.butNextMonth=document.getElementById(this.id+"-next-month-but"),this.noToday&&(this.butToday.style.display="none"),this.showWeeks&&(this.wkThs=this.table.getElementsByTagName("tbody")[0].getElementsByTagName("th"),this.div.className+=" weeks-displayed"),g=f=c=b=a=null,this.updateTableHeaders(),this.created=!0,this.updateTable(),this.staticPos?(this.visible=!0,this.opacity=100,this.div.style.visibility="visible",this.div.style.display="block",this.noFocus=!0,this.fade()):(this.reposition(),this.div.style.visibility="visible",this.fade(),this.noFocus=!0),this.callback("domcreate",{id:this.id})}},this.transEnd=function(){h.div.style.display="none",h.div.style.visibility="hidden",n(h.div,"hidden","true")},this.fade=function(){if(window.clearTimeout(h.fadeTimer),h.fadeTimer=null,A)return h.opacity=h.opacityTo,void(0==h.opacityTo?(h.visible=!1,j(h.div,B,h.transEnd),c(h.div,"fd-dp-fade")):(k(h.div,B,h.transEnd),h.visible=!0,h.div.style.display="block",h.div.style.visibility="visible",n(h.div,"hidden","false"),d(h.div,"fd-dp-fade")));var a=Math.round(h.opacity+(h.opacityTo-h.opacity)/4);h.setOpacity(a),Math.abs(h.opacityTo-a)>3&&!h.noFadeEffect?h.fadeTimer=window.setTimeout(h.fade,50):(h.setOpacity(h.opacityTo),0==h.opacityTo?(h.div.style.display="none",h.div.style.visibility="hidden",n(h.div,"hidden","true"),h.visible=!1):(n(h.div,"hidden","false"),h.visible=!0))},this.trackDrag=function(a){a=a||window.event;var b=(a.pageX?a.pageX:a.clientX?a.clientX:a.x)-h.mx,c=(a.pageY?a.pageY:a.clientY?a.clientY:a.Y)-h.my;h.div.style.left=Math.round(h.x+b)>0?Math.round(h.x+b)+"px":"0px",h.div.style.top=Math.round(h.y+c)>0?Math.round(h.y+c)+"px":"0px",6!==X||h.staticPos||(h.iePopUp.style.top=h.div.style.top,h.iePopUp.style.left=h.div.style.left)},this.stopDrag=function(a){var b=document.getElementsByTagName("body")[0];d(b,"fd-drag-active"),k(document,"mousemove",h.trackDrag,!1),k(document,"mouseup",h.stopDrag,!1),h.div.style.zIndex=9999},this.onmousedown=function(a){a=a||document.parentWindow.event;var b=null!=a.target?a.target:a.srcElement,d=b,e=!0,f=new RegExp("^fd-(but-)?"+h.id+"$");
// Are we within the wrapper div or the button
for(h.mouseDownElem=null;b;){if(b.id&&b.id.length&&b.id.search(f)!=-1){e=!1;break}try{b=b.parentNode}catch(g){break}}
// If not, then ...
if(e)return _(),!0;if((h.div.className+d.className).search("fd-disabled")!=-1)return!0;
// We check the mousedown events on the buttons
if(d.id.search(new RegExp("^"+h.id+"(-prev-year-but|-prev-month-but|-next-month-but|-next-year-but)$"))!=-1){h.mouseDownElem=d,j(document,"mouseup",h.clearTimer),j(d,"mouseout",h.clearTimer);var k={"-prev-year-but":[0,-1,0],"-prev-month-but":[0,0,-1],"-next-year-but":[0,1,0],"-next-month-but":[0,0,1]},m=d.id.replace(h.id,""),n=Number(h.date.getFullYear()+i(h.date.getMonth()+1));return h.timerInc=800,h.timerSet=!0,h.dayInc=k[m][0],h.yearInc=k[m][1],h.monthInc=k[m][2],h.accellerator=1,h.currentYYYYMM!=n&&(h.currentYYYYMM<n&&(h.yearInc==-1||h.monthInc==-1)||h.currentYYYYMM>n&&(1==h.yearInc||1==h.monthInc)?(h.delayedUpdate=!1,h.timerInc=1200):h.delayedUpdate=!0),h.updateTable(),l(a)}return b.className.search("drag-enabled")==-1||(h.mx=a.pageX?a.pageX:a.clientX?a.clientX:a.x,h.my=a.pageY?a.pageY:a.clientY?a.clientY:a.Y,h.x=parseInt(h.div.style.left,10),h.y=parseInt(h.div.style.top,10),j(document,"mousemove",h.trackDrag,!1),j(document,"mouseup",h.stopDrag,!1),c(document.getElementsByTagName("body")[0],"fd-drag-active"),h.div.style.zIndex=1e4,l(a))},this.onclick=function(a){if(!A&&h.opacity!=h.opacityTo||h.disabled)return l(a);a=a||document.parentWindow.event;for(var b=null!=a.target?a.target:a.srcElement;b.parentNode;){
// Are we within a valid i.e. clickable TD node
if(b.tagName&&"td"==b.tagName.toLowerCase()){if(b.className.search(/cd-([0-9]{8})/)==-1||b.className.search(R)!=-1)return l(a);var c=b.className.match(/cd-([0-9]{8})/)[1];h.date=new Date(c.substr(0,4),c.substr(4,2)-1,c.substr(6,2),5,0,0),h.dateSet=new Date(h.date),h.noFocus=!0,h.callback("dateset",{id:h.id,date:h.dateSet,dd:h.dateSet.getDate(),mm:h.dateSet.getMonth()+1,yyyy:h.dateSet.getFullYear()}),h.returnFormattedDate(),h.hide(),h.stopTimer();break}if(b.id&&b.id==h.id+"-today-but"){h.date=new Date,h.updateTable(),h.stopTimer();break}if(b.className.search(/date-picker-day-header/)!=-1){for(var d=h.showWeeks?-1:0,e=b;e.previousSibling;)e=e.previousSibling,e.tagName&&"th"==e.tagName.toLowerCase()&&d++;h.firstDayOfWeek=(h.firstDayOfWeek+d)%7,h.updateTableHeaders();break}try{b=b.parentNode}catch(f){break}}return l(a)},this.show=function(a){if(!this.staticPos){var b,d;for(d in this.formElements)if(b=document.getElementById(this.id),!b||b&&b.disabled)return;this.noFocus=!0,
// If the datepicker doesn't exist in the dom
this.created&&document.getElementById("fd-"+this.id)?(this.setDateFromInput(),this.reposition()):(this.created=!1,this.fullCreate=!1,this.create(),this.fullCreate=!0),this.noFocus=!a,this.noFocus?(this.clickActivated=!0,this.showCursor=!1,j(document,"mousedown",this.onmousedown),D&&(window.addEventListener&&!window.devicePixelRatio?window.addEventListener("DOMMouseScroll",this.onmousewheel,!1):(j(document,"mousewheel",this.onmousewheel),j(window,"mousewheel",this.onmousewheel)))):(this.clickActivated=!1,this.showCursor=!0),this.opacityTo=100,this.div.style.display="block",6===X&&(this.iePopUp.style.width=this.div.offsetWidth+"px",this.iePopUp.style.height=this.div.offsetHeight+"px",this.iePopUp.style.display="block"),this.setNewFocus(),this.fade();var e=document.getElementById("fd-but-"+this.id);e&&c(e,"date-picker-button-active")}},this.hide=function(){if(this.visible&&this.created&&document.getElementById("fd-"+this.id)&&(this.kbEvent=!1,d(h.div,"date-picker-focus"),this.stopTimer(),this.removeOnFocusEvents(),this.clickActivated=!1,this.noFocus=!0,this.showCursor=!1,this.setNewFocus(),!this.staticPos)){this.statusBar&&this.updateStatus(ea(9));var a=document.getElementById("fd-but-"+this.id);if(a&&d(a,"date-picker-button-active"),k(document,"mousedown",this.onmousedown),D)if(window.addEventListener&&!window.devicePixelRatio)try{window.removeEventListener("DOMMouseScroll",this.onmousewheel,!1)}catch(b){}else k(document,"mousewheel",this.onmousewheel),k(window,"mousewheel",this.onmousewheel);6===X&&(this.iePopUp.style.display="none"),this.opacityTo=0,this.fade()}},this.onblur=function(a){h.removeCursorHighlight(),h.hide()},
// The current cursor cell gains focus
this.onfocus=function(a){h.noFocus=!1,c(h.div,"date-picker-focus"),h.statusBar&&h.updateStatus(ka(h.date,h.statusFormat,!0)),h.showCursor=!0,h.addCursorHighlight(),h.addOnFocusEvents()},this.onmousewheel=function(a){a=a||document.parentWindow.event;var b=0;a.wheelDelta?(b=a.wheelDelta/120,s&&window.opera.version()<9.2&&(b=-b)):a.detail&&(b=-a.detail/3);var c=h.date.getDate(),d=new Date(h.date),e=b>0?1:-1;return d.setDate(2),d.setMonth(d.getMonth()+1*e),d.setDate(Math.min(c,ha(d.getMonth(),d.getFullYear()))),h.outOfRange(d)?l(a):(h.date=new Date(d),h.updateTable(),h.statusBar&&h.updateStatus(ka(h.date,h.statusFormat,!0)),l(a))},this.onkeydown=function(a){if(h.stopTimer(),!h.visible)return!1;a=a||document.parentWindow.event;var b=a.keyCode?a.keyCode:a.charCode;if(13==b){
// RETURN/ENTER: close & select the date
var c=document.getElementById(h.id+"-date-picker-hover");return c&&c.className.search(/cd-([0-9]{8})/)!=-1&&c.className.search(/out-of-range|day-disabled/)==-1?(h.dateSet=new Date(h.date),h.callback("dateset",h.createCbArgObj()),h.returnFormattedDate(),h.hide(),l(a)):l(a)}if(27==b){
// ESC: close, no date selection, refocus on popup button
if(!h.staticPos){h.hide();var d=document.getElementById("fd-but-"+h.id);return d&&setTimeout(function(){try{d.focus()}catch(a){}},0),l(a)}return!0}if(32==b||0==b)
// SPACE: goto todays date
return h.date=new Date,h.updateTable(),l(a);if(9==b)
// TAB: pass focus - non popup datepickers only
// TAB: pass focus - non popup datepickers only
return!!h.staticPos||l(a);
// TODO - test the need for the IE specific stuff in IE9
// Internet Explorer fires the keydown event faster than the JavaScript engine can
// update the interface. The following attempts to fix this.
if(X){if((new Date).getTime()-h.interval.getTime()<50)return l(a);h.interval=new Date}
// A number key has been pressed so change the first day of the week
if(b>49&&b<56||b>97&&b<104)return b>96&&(b-=48),b-=49,h.firstDayOfWeek=(h.firstDayOfWeek+b)%7,h.updateTableHeaders(),l(a);
// If outside any other tested keycodes then let the keystroke pass
if(b<33||b>40)return!0;var e=new Date(h.date);h.date.getFullYear()+i(h.date.getMonth()+1);
// HOME: Set date to first day of current month
if(36==b)e.setDate(1);else if(35==b)e.setDate(ha(e.getMonth(),e.getFullYear()));else if(33==b||34==b){var f=34==b?1:-1;
// CTRL + PAGE UP/DOWN: Moves to the same date in the previous/next year
if(a.ctrlKey)e.setFullYear(e.getFullYear()+1*f);else{var g=h.date.getDate();e.setDate(2),e.setMonth(e.getMonth()+1*f),e.setDate(Math.min(g,ha(e.getMonth(),e.getFullYear())))}}else 37==b?e=new Date(h.date.getFullYear(),h.date.getMonth(),h.date.getDate()-1,5,0,0):39==b||34==b?e=new Date(h.date.getFullYear(),h.date.getMonth(),h.date.getDate()+1,5,0,0):38==b?e=new Date(h.date.getFullYear(),h.date.getMonth(),h.date.getDate()-7,5,0,0):40==b&&(e=new Date(h.date.getFullYear(),h.date.getMonth(),h.date.getDate()+7,5,0,0));
// If the new date is out of range then disallow action
if(h.outOfRange(e))return l(a);
// Otherwise set the new cursor date
h.date=e,
// Update the status bar if needs be
h.statusBar&&h.updateStatus(h.getBespokeTitle(h.date.getFullYear(),h.date.getMonth()+1,h.date.getDate())||ka(h.date,h.statusFormat,!0));
// YYYYMMDD format String of the current cursor date
var j=String(h.date.getFullYear())+i(h.date.getMonth()+1)+i(h.date.getDate());
// If we need to redraw the UI completely
if(a.ctrlKey||33==b||34==b||j<h.firstDateShown||j>h.lastDateShown)h.updateTable(),X&&(h.interval=new Date);else{
// Do we need to disable the today button for this date
h.noToday||h.disableTodayButton(),
// Remove focus from the previous cell
h.removeOldFocus(),
// Show/hide the month & year buttons
h.showHideButtons(h.date);
// Locate this TD
for(var c,k=0;c=h.tds[k];k++)if(c.className.search("cd-"+j)!=-1){c.id=h.id+"-date-picker-hover",h.setNewFocus();break}}return l(a)},this.onmouseout=function(a){a=a||document.parentWindow.event;for(var b=a.toElement||a.relatedTarget;b&&b!=this;)try{b=b.parentNode}catch(a){b=this}return b!=this&&((h.clickActivated||h.staticPos&&!h.kbEventsAdded)&&(h.showCursor=!1,h.removeCursorHighlight()),h.currentTR&&(h.currentTR.className="",h.currentTR=null),void(h.statusBar&&h.updateStatus(h.dateSet?h.getBespokeTitle(h.dateSet.getFullYear(),h.dateSet.getMonth()+1,h.dateSet.getDate())||ka(h.dateSet,h.statusFormat,!0):ea(9))))},this.onmouseover=function(a){a=a||document.parentWindow.event;for(var b=null!=a.target?a.target:a.srcElement;1!=b.nodeType;)b=b.parentNode;if(b&&b.tagName){h.noFocus=!0;var c=ea(9);switch((h.clickActivated||h.staticPos&&!h.kbEventsAdded)&&(h.showCursor=!1),b.tagName.toLowerCase()){case"td":if(b.className.search(/date-picker-unused|out-of-range/)!=-1&&(c=ea(9)),b.className.search(/cd-([0-9]{8})/)!=-1){h.showCursor=!0,h.stopTimer();var d=b.className.match(/cd-([0-9]{8})/)[1];h.removeOldFocus(),b.id=h.id+"-date-picker-hover",h.setNewFocus(),h.date=new Date((+d.substr(0,4)),+d.substr(4,2)-1,(+d.substr(6,2)),5,0,0),h.noToday||h.disableTodayButton(),c=h.getBespokeTitle(+d.substr(0,4),+d.substr(4,2),+d.substr(6,2))||ka(h.date,h.statusFormat,!0)}break;case"th":if(!h.statusBar)break;if(b.className.search(/drag-enabled/)!=-1)c=ea(10);else if(b.className.search(/date-picker-week-header/)!=-1){var e=b.firstChild?b.firstChild.nodeValue:"";c=e.search(/^(\d+)$/)!=-1?ea(7,[e,e<3&&11==h.date.getMonth()?ia(h.date.getFullYear())+1:ia(h.date.getFullYear())]):ea(9)}break;case"span":if(!h.statusBar)break;if(b.className.search(/day-([0-6])/)!=-1){var f=b.className.match(/day-([0-6])/)[1];c=ea(11,[fa(f,!1)])}else b.className.search(/(drag-enabled|today-but|prev-(year|month)|next-(year|month))/)!=-1&&b.className.search(/disabled/)==-1&&(c=ea({"drag-enabled":10,"prev-year":2,"prev-month":0,"next-year":3,"next-month":1,"today-but":12}[b.className.match(/(drag-enabled|today-but|prev-(year|month)|next-(year|month))/)[0]]));break;default:c=""}for(;b.parentNode;)if(b=b.parentNode,1==b.nodeType&&"tr"==b.tagName.toLowerCase()){if(h.currentTR){if(b==h.currentTR)break;h.currentTR.className=""}b.className="dp-row-highlight",h.currentTR=b;break}h.statusBar&&c&&h.updateStatus(c),h.showCursor||h.removeCursorHighlight()}},this.clearTimer=function(){h.stopTimer(),h.timerInc=800,h.yearInc=0,h.monthInc=0,h.dayInc=0,k(document,"mouseup",h.clearTimer),null!=h.mouseDownElem&&k(h.mouseDownElem,"mouseout",h.clearTimer),h.mouseDownElem=null};var h=this;this.setDateFromInput(),this.staticPos?this.create():this.createButton(),function(){var a,b,c=0;for(a in h.formElements)b=document.getElementById(a),b&&b.tagName&&b.tagName.search(/select|input/i)!=-1&&(j(b,"change",h.changeHandler),0==c&&b.form&&j(b.form,"reset",h.reset),c++),b&&1!=b.disabled||h.disableDatePicker()}(),
// We have fully created the datepicker...
this.fullCreate=!0}var r=!1,s="[object Opera]"===Object.prototype.toString.call(window.opera),t="",u=e(),v=String.fromCharCode(160),w={},x={},y={},z=100,A=null,B="",C=!0,D=!0,E=!0,F=!1,G=!1,H=!1,I=!1,J=!0,K="%d %F %Y",L="%F %d, %Y",M="",N=s?["%j"]:["%j"," %F %Y"],O=/%([d|j])/,P=/%([M|F|m|n])/,Q=/%[y|Y]/,R=/date-picker-unused|out-of-range|day-disabled|not-selectable/,S=/%([d|j|M|F|m|n|Y|y])/,T=/%([d|D|l|j|N|w|S|W|M|F|m|n|t|Y|y])/,U=/^((\d\d\d\d)(0[1-9]|1[012])(0[1-9]|[12][0-9]|3[01]))$/,V=/^(((\d\d\d\d)|(\*\*\*\*))((0[1-9]|1[012])|(\*\*))(0[1-9]|[12][0-9]|3[01]))$/,W="\t\n\x0B\f\r   ᠎             　\u2028\u2029",
// https://gist.github.com/padolsey/527683
X=function(){for(var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0];);return b>4?b:a}();!function(){var a=document.getElementsByTagName("script"),b=g(String(a[a.length-1].innerHTML).replace(/[\n\r\s\t]+/g," ").replace(/^\s+/,"").replace(/\s+$/,""));if("object"!=typeof b||"err"in b||f(b),E&&"object"!=typeof fdLocale){var c,d,e=document.getElementsByTagName("head")[0]||document.documentElement,h=H?H:a[a.length-1].src.substr(0,a[a.length-1].src.lastIndexOf("/"))+"/lang/";for(d=0;d<u.length;d++)if(c=document.createElement("script"),c.type="text/javascript",c.src=h+u[d]+".js",c.charSet="utf-8",X&&X<8){var i=document.getElementsByTagName("base");i.length&&i[0].childNodes.length?i[0].appendChild(c):e.appendChild(c),i=null}else e.appendChild(c);c=null}else I=!0}();
// Cross browser split from http://blog.stevenlevithan.com/archives/cross-browser-split
var Y=function(a,b,c){
// if `separator` is not a regex, use the native `split`
if("[object RegExp]"!==Object.prototype.toString.call(b))return Y._nativeSplit.call(a,b,c);var d,e,f,g,h=[],i=0,j="",b=RegExp(b.source,"g");/* behavior for `limit`: if it's...
        - `undefined`: no limit.
        - `NaN` or zero: return an empty array.
        - a positive number: use `Math.floor(limit)`.
        - a negative number: no limit.
        - other: type-convert, then use the above rules. */
if(a+="",Y._compliantExecNpcg||(d=RegExp("^"+b.source+"$(?!\\s)",j)),void 0===c||+c<0)c=1/0;else if(c=Math.floor(+c),!c)return[];for(;(e=b.exec(a))&&(f=e.index+e[0].length,!(f>i&&(h.push(a.slice(i,e.index)),
// fix browsers whose `exec` methods don't consistently return `undefined` for nonparticipating capturing groups
!Y._compliantExecNpcg&&e.length>1&&e[0].replace(d,function(){for(var a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(e[a]=void 0)}),e.length>1&&e.index<a.length&&Array.prototype.push.apply(h,e.slice(1)),g=e[0].length,i=f,h.length>=c)));)b.lastIndex===e.index&&
// avoid an infinite loop
b.lastIndex++;return i===a.length?!g&&b.test("")||h.push(""):h.push(a.slice(i)),h.length>c?h.slice(0,c):h};
// NPCG: nonparticipating capturing group
Y._compliantExecNpcg=void 0===/()??/.exec("")[1],Y._nativeSplit=String.prototype.split,q.prototype.addButtonEvents=function(a){function b(a){a=a||window.event;var b=this.id.replace("fd-but-",""),e=ra(b),f=!1,g=w[b].kbEvent;if(g)return void(w[b].kbEvent=!1);if("keydown"==a.type){var h=null!=a.keyCode?a.keyCode:a.charCode;if(13!=h)return!0;if(w[b].kbEvent=!0,e)return d(this,"date-picker-button-active"),_(),l(a);f=!0}else w[b].kbEvent=!1;return e?(d(this,"date-picker-button-active"),_()):(c(this,"date-picker-button-active"),_(b),ba(b,f)),l(a)}a.onclick=b,a.onkeydown=b,C?o(a,this.bespokeTabIndex):o(a,-1)},q.prototype.createButton=function(){if(!this.staticPos&&!document.getElementById("fd-but-"+this.id)){var a=document.getElementById(this.id),b=document.createElement("span"),c=document.createElement("a");c.href="#"+this.id,c.className="date-picker-control",c.title=ea(5),c.id="fd-but-"+this.id,b.appendChild(document.createTextNode(v)),c.appendChild(b),b=document.createElement("span"),b.className="fd-screen-reader",b.appendChild(document.createTextNode(c.title)),c.appendChild(b),
// Set the ARIA role to be "button"
m(c,"button"),
// Set a "haspopup" ARIA property
n(c,"haspopup",!0),this.positioned&&document.getElementById(this.positioned)?document.getElementById(this.positioned).appendChild(c):a.parentNode.insertBefore(c,a.nextSibling),this.addButtonEvents(c),c=null,this.callback("dombuttoncreate",{id:this.id})}},q.prototype.setBespokeTitles=function(a){this.bespokeTitles={},this.addBespokeTitles(a)},q.prototype.addBespokeTitles=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.bespokeTitles[b]=a[b])},q.prototype.getBespokeTitle=function(a,b,c){var d,e,f=a+String(i(b))+i(c);
// Try the datepickers bespoke titles
for(d in this.bespokeTitles)if(this.bespokeTitles.hasOwnProperty(d)&&(e=String(d).replace(/^(\*\*\*\*)/,a).replace(/^(\d\d\d\d)(\*\*)/,"$1"+i(b)),e==f))return this.bespokeTitles[d];
// Try the generic bespoke titles
for(d in y)if(y.hasOwnProperty(d)&&(e=String(d).replace(/^(\*\*\*\*)/,a).replace(/^(\d\d\d\d)(\*\*)/,"$1"+i(b)),e==f))return y[d];return!1},q.prototype.returnSelectedDate=function(){return this.dateSet},q.prototype.setRangeLow=function(a){if(String(a).search(U)==-1){if(r)throw"Invalid value passed to setRangeLow method: "+a;return!1}this.rangeLow=a,this.inUpdate||this.setDateFromInput()},q.prototype.setRangeHigh=function(a){if(String(a).search(U)==-1){if(r)throw"Invalid value passed to setRangeHigh method: "+a;return!1}this.rangeHigh=a,this.inUpdate||this.setDateFromInput()},q.prototype.setDisabledDays=function(a){if(!a.length||a.join("").search(/^([0|1]{7})$/)==-1){if(r)throw"Invalid values located when attempting to call setDisabledDays";return!1}this.disabledDays=a,this.inUpdate||this.setDateFromInput()},q.prototype.setDisabledDates=function(a){this.filterDateList(a,!0)},q.prototype.setEnabledDates=function(a){this.filterDateList(a,!1)},q.prototype.addDisabledDates=function(a){this.addDatesToList(a,!0)},q.prototype.addEnabledDates=function(a){this.addDatesToList(a,!1)},q.prototype.filterDateList=function(a,b){for(var c=[],d=0;d<this.dateList.length;d++)this.dateList[d].type!=b&&c.push(this.dateList[d]);this.dateList=c.concat(),this.addDatesToList(a,b)},q.prototype.addDatesToList=function(a,b){var c;for(c in a)if(String(c).search(V)!=-1&&(1==a[c]||String(a[c]).search(V)!=-1)){if(1!=a[c]&&Number(String(c).replace(/^\*\*\*\*/,2010).replace(/^(\d\d\d\d)(\*\*)/,"$122"))>Number(String(a[c]).replace(/^\*\*\*\*/,2010).replace(/^(\d\d\d\d)(\*\*)/,"$122")))continue;this.dateList.push({type:!!b,rLow:c,rHigh:a[c]})}this.inUpdate||this.setDateFromInput()},q.prototype.setSelectedDate=function(a){if(String(a).search(V)==-1)return!1;var b=a.match(U),c=new Date((+b[2]),+b[3]-1,(+b[4]),5,0,0);return!(!c||isNaN(c)||!this.canDateBeSelected(c))&&(this.dateSet=new Date(c),this.inUpdate||this.updateTable(),this.callback("dateset",this.createCbArgObj()),void this.returnFormattedDate())},q.prototype.checkSelectedDate=function(){this.dateSet&&!this.canDateBeSelected(this.dateSet)&&(this.dateSet=null),this.inUpdate||this.updateTable()},q.prototype.addOnFocusEvents=function(){this.kbEventsAdded||this.noFocus||(j(document,"keypress",this.onkeydown),j(document,"mousedown",this.onmousedown),X&&(k(document,"keypress",this.onkeydown),j(document,"keydown",this.onkeydown)),window.devicePixelRatio&&(k(document,"keypress",this.onkeydown),j(document,"keydown",this.onkeydown)),this.noFocus=!1,this.kbEventsAdded=!0)},q.prototype.removeOnFocusEvents=function(){this.kbEventsAdded&&(k(document,"keypress",this.onkeydown),k(document,"keydown",this.onkeydown),k(document,"mousedown",this.onmousedown),this.kbEventsAdded=!1)},q.prototype.stopTimer=function(){this.timerSet=!1,window.clearTimeout(this.timer)},q.prototype.setOpacity=function(a){this.div.style.opacity=a/100,this.div.style.filter="alpha(opacity="+a+")",this.opacity=a},q.prototype.truePosition=function(a){var b=this.cumulativeOffset(a);if(s)return b;var c=document.compatMode&&"BackCompat"!=document.compatMode?document.documentElement:document.body,d=document.all?c.scrollLeft:window.pageXOffset,e=document.all?c.scrollTop:window.pageYOffset,f=this.realOffset(a);return[b[0]-f[0]+d,b[1]-f[1]+e]},q.prototype.realOffset=function(a){var b=0,c=0;do b+=a.scrollTop||0,c+=a.scrollLeft||0,a=a.parentNode;while(a);return[c,b]},q.prototype.cumulativeOffset=function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return[c,b]},q.prototype.outOfRange=function(a){if(!this.rangeLow&&!this.rangeHigh)return!1;var b=!1;a||(b=!0,a=this.date);var c=i(a.getDate()),d=i(a.getMonth()+1),e=a.getFullYear(),f=String(e)+String(d)+String(c);if(this.rangeLow&&+f<+this.rangeLow)return!b||(this.date=new Date(this.rangeLow.substr(0,4),this.rangeLow.substr(4,2)-1,this.rangeLow.substr(6,2),5,0,0),!1);if(this.rangeHigh&&+f>+this.rangeHigh){if(!b)return!0;this.date=new Date(this.rangeHigh.substr(0,4),this.rangeHigh.substr(4,2)-1,this.rangeHigh.substr(6,2),5,0,0)}return!1},q.prototype.canDateBeSelected=function(a){if(!a||isNaN(a))return!1;var b=i(a.getDate()),c=i(a.getMonth()+1),d=a.getFullYear(),e=d+""+c+b,f=this.getDateExceptions(d,c),g=0==a.getDay()?7:a.getDay();
// If date out of range
// or the date has been explicitly disabled
// or the date lies on a disabled weekday and it hasn't been explicitly enabled
return!(this.rangeLow&&+e<+this.rangeLow||this.rangeHigh&&+e>+this.rangeHigh||e in f&&1==f[e]||this.disabledDays[g-1]&&(!(e in f)||e in f&&1==f[e]))},q.prototype.updateStatus=function(a){
// All this arseing about just for sups in the footer... nice typography and all that...
if(b(this.statusBar),a&&this.statusFormat.search(/%S/)!=-1&&a.search(/([0-9]{1,2})(st|nd|rd|th)/)!=-1){a=Y(a.replace(/([0-9]{1,2})(st|nd|rd|th)/,"$1<sup>$2</sup>"),/<sup>|<\/sup>/);for(var c,d=document.createDocumentFragment(),e=0;c=a[e];e++)if(/^(st|nd|rd|th)$/.test(c)){var f=document.createElement("sup");f.appendChild(document.createTextNode(c)),d.appendChild(f)}else d.appendChild(document.createTextNode(c));this.statusBar.appendChild(d)}else this.statusBar.appendChild(document.createTextNode(a?a:ea(9)))},/* Still needs work... */
q.prototype.setDateFromInput=function(){var a,b,e,f,g,h,i,j,k,l,m,n=(this.dateSet,!1),o=!this.staticPos&&document.getElementById("fd-but-"+this.id),p=F.imported?[].concat(Z.fullMonths).concat(Z.monthAbbrs):[],q=F.imported?[].concat(F.fullMonths).concat(F.monthAbbrs):[],r=/(3[01]|[12][0-9]|0?[1-9])(st|nd|rd|th)/i,s=0,t=!1;
// Reset the internal dateSet variable
this.dateSet=null;
// Try and get a year, month and day from the form element values
for(e in this.formElements){if(f=document.getElementById(e),!f)return!1;if(s++,j=String(f.value))for(g=this.formElements[e],a=[g],t=!1,k=g.search(O)!=-1,l=g.search(P)!=-1,m=g.search(Q)!=-1,
// Try to assign some default date formats to throw at
// the (simple) regExp parser for single date parts.
k&&l&&m||(!m||l||k?!l||m||k?!k||m||l||(a=a.concat(["%d%","%j"])):a=a.concat(["%M","%F","%m","%n"]):a=a.concat(["%Y","%y"])),b=0;b<a.length&&(t=la(j,a[b]),t&&(!h&&k&&t.d&&(h=t.d),n===!1&&l&&t.m&&(n=t.m),!i&&m&&t.y&&(i=t.y)),!(k&&h||!k)||(!l||!n!=!1)&&l||!(m&&i||!m));b++);}
// Last ditch attempt at date parsing for single inputs that
// represent the day, month and year parts of the date format.
// I'm - thankfully - passing this responsibility off to the browser.
// Date parsing in js sucks but the browsers' in-built Date.parse method
// will inevitably be better than anything I would hazard to write.
// Date.parse is implementation dependant though so don't expect
// consistency, rhyme or reason.
if(J&&(!h||n===!1||!i)&&k&&l&&m&&1==s&&j){
// If locale imported then replace month names with English
// counterparts if necessary
if(F.imported)for(b=0;b<q.length;b++)j=j.replace(new RegExp(q[b],"i"),p[b]);
// Remove English ordinal suffix
j.search(r)!=-1&&(j=j.replace(r,j.match(r)[1])),
// Older browsers have problems with dashes so we replace with
// slashes which appear to be supported by all and then try to use
// the in-built Date Object to parse a valid date
t=new Date(j.replace(new RegExp("-","g"),"/")),t&&!isNaN(t)&&(h=t.getDate(),n=t.getMonth()+1,i=t.getFullYear())}if(t=!1,h&&n!==!1&&i&&(+h>ha(+n-1,+i)?(h=ha(+n-1,+i),t=!1):t=new Date((+i),+n-1,(+h),5,0,0)),o&&d(o,"date-picker-dateval"),!t||isNaN(t)){var u=new Date(i||(new Date).getFullYear(),n!==!1?n-1:(new Date).getMonth(),1,5,0,0);return this.date=this.cursorDate?new Date((+this.cursorDate.substr(0,4)),+this.cursorDate.substr(4,2)-1,(+this.cursorDate.substr(6,2)),5,0,0):new Date(u.getFullYear(),u.getMonth(),Math.min(+h||(new Date).getDate(),ha(u.getMonth(),u.getFullYear())),5,0,0),this.outOfRange(),void(this.fullCreate&&this.updateTable())}t.setHours(5),this.date=new Date(t),this.outOfRange(),t.getTime()==this.date.getTime()&&this.canDateBeSelected(this.date)&&(this.dateSet=new Date(this.date),o&&c(o,"date-picker-dateval"),this.returnFormattedDate(!0)),this.fullCreate&&this.updateTable()},q.prototype.setSelectIndex=function(a,b){for(var c=a.options.length-1;c>=0;c--)if(a.options[c].value==b)return void(a.selectedIndex=c)},q.prototype.returnFormattedDate=function(a){var b=!this.staticPos&&document.getElementById("fd-but-"+this.id);if(!this.dateSet)return void(b&&d(b,"date-picker-dateval"));var e,f,g,h,j=(i(this.dateSet.getDate()),i(this.dateSet.getMonth()+1),this.dateSet.getFullYear(),!1);a=!!a;for(e in this.formElements){if(f=document.getElementById(e),!f)return;j||(j=f),g=this.formElements[e],h=ka(this.dateSet,g,I),"input"==f.tagName.toLowerCase()?f.value=h:this.setSelectIndex(f,h)}if(this.staticPos?(this.noFocus=!0,this.updateTable(),this.noFocus=!1):b&&c(b,"date-picker-dateval"),this.fullCreate&&j.type&&"hidden"!=j.type&&!a)try{j.focus()}catch(k){}a||this.callback("datereturned",this.createCbArgObj())},q.prototype.disableDatePicker=function(){if(!this.disabled){if(this.staticPos)this.removeOnFocusEvents(),this.removeOldFocus(),this.noFocus=!0,c(this.div,"date-picker-disabled"),this.table.onmouseover=this.table.onclick=this.table.onmouseout=this.table.onmousedown=null,k(document,"mousedown",this.onmousedown),k(document,"mouseup",this.clearTimer);else{this.visible&&this.hide();var a=document.getElementById("fd-but-"+this.id);a&&(c(a,"date-picker-control-disabled"),
// Set a "disabled" ARIA state
n(a,"disabled",!0),a.onkeydown=a.onclick=function(){return!1},o(a,-1),a.title="")}clearTimeout(this.timer),this.disabled=!0}},q.prototype.enableDatePicker=function(){if(this.disabled){if(this.staticPos)this.removeOldFocus(),null!=this.dateSet&&(this.date=this.dateSet),this.noFocus=!0,this.updateTable(),d(this.div,"date-picker-disabled"),this.disabled=!1,this.table.onmouseover=this.onmouseover,this.table.onmouseout=this.onmouseout,this.table.onclick=this.onclick,this.table.onmousedown=this.onmousedown;else{var a=document.getElementById("fd-but-"+this.id);a&&(d(a,"date-picker-control-disabled"),
// Reset the "disabled" ARIA state
n(a,"disabled",!1),this.addButtonEvents(a),a.title=ea(5))}this.disabled=!1}},q.prototype.disableTodayButton=function(){var a=new Date;d(this.butToday,"fd-disabled"),(this.outOfRange(a)||this.date.getDate()==a.getDate()&&this.date.getMonth()==a.getMonth()&&this.date.getFullYear()==a.getFullYear())&&c(this.butToday,"fd-disabled")},q.prototype.updateTableHeaders=function(){for(var a,e,f=this.showWeeks?8:7,g=this.showWeeks?1:0,h=g;h<f;h++)a=(this.firstDayOfWeek+(h-g))%7,this.ths[h].title=fa(a,!1),h>g?(e=this.ths[h].getElementsByTagName("span")[0],b(e),e.appendChild(document.createTextNode(fa(a,!0))),e.title=this.ths[h].title,e=null):(b(this.ths[h]),this.ths[h].appendChild(document.createTextNode(fa(a,!0)))),d(this.ths[h],"date-picker-highlight"),this.highlightDays[a]&&c(this.ths[h],"date-picker-highlight");this.created&&this.updateTable()},q.prototype.callback=function(a,b){if(!(a&&a in this.callbacks))return!1;var c,d=!1;for(c=0;c<this.callbacks[a].length;c++)d=this.callbacks[a][c](b||this.id);return d},q.prototype.showHideButtons=function(a){if(this.butPrevYear){var b=a.getMonth(),e=a.getFullYear();this.outOfRange(new Date(e-1,b,ha(+b,e-1),5,0,0))?(c(this.butPrevYear,"fd-disabled"),this.yearInc==-1&&this.stopTimer()):d(this.butPrevYear,"fd-disabled"),this.outOfRange(new Date(e,+b-1,ha(+b-1,e),5,0,0))?(c(this.butPrevMonth,"fd-disabled"),this.monthInc==-1&&this.stopTimer()):d(this.butPrevMonth,"fd-disabled"),this.outOfRange(new Date(e+1,(+b),1,5,0,0))?(c(this.butNextYear,"fd-disabled"),1==this.yearInc&&this.stopTimer()):d(this.butNextYear,"fd-disabled"),this.outOfRange(new Date(e,+b+1,1,5,0,0))?(c(this.butNextMonth,"fd-disabled"),1==this.monthInc&&this.stopTimer()):d(this.butNextMonth,"fd-disabled")}};var Z={fullMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbrs:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullDays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],dayAbbrs:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],titles:["Previous month","Next month","Previous year","Next year","Today","Show Calendar","wk","Week [[%0%]] of [[%1%]]","Week","Select a date","Click & Drag to move","Display “[[%0%]]” first","Go to Today’s date","Disabled date :"],rtl:!1,firstDayOfWeek:0,imported:!1},$=function(){var a,b;for(a in w)for(b in w[a].formElements)if(!document.getElementById(b)){w[a].destroy(),w[a]=null,delete w[a];break}},_=function(a){var b;for(b in w)!w[b].created||a&&a==w[b].id||w[b].hide()},aa=function(a){if(a in w){if(!w[a].created||w[a].staticPos)return;w[a].hide()}},ba=function(a,b){return a in w&&(w[a].clickActivated=!b,w[a].show(b),!0)},ca=function(b){
// Don't remove datepickers if it's a pagehide/pagecache event (webkit et al)
if(b=b||window.event,!b.persisted){var c;for(c in w)w[c].destroy(),w[c]=null,delete w[c];w=null,k(window,"unload",a.destroy)}},da=function(a){a&&a in w&&(w[a].destroy(),w[a]=null,delete w[a])},ea=function(a,b){if(b=b||[],F.titles.length>a){var c=F.titles[a];if(b&&b.length)for(var d=0;d<b.length;d++)c=c.replace("[[%"+d+"%]]",b[d]);return c.replace(/[[%(\d)%]]/g,"")}return""},fa=function(a,b){var c=F[b?"dayAbbrs":"fullDays"];return c.length&&c.length>a?c[a]:""},ga=function(a,b){var c=F[b?"monthAbbrs":"fullMonths"];return c.length&&c.length>a?c[a]:""},ha=function(a,b){return a=(a+12)%12,0!=b%4||0==b%100&&0!=b%400||1!=a?[31,28,31,30,31,30,31,31,30,31,30,31][a]:29},ia=function(a){if(a in x)return x[a];var b=new Date(a,0,4),c=new Date(a,11,28);return b.setDate(b.getDate()-(6+b.getDay())%7),c.setDate(c.getDate()+(7-c.getDay())%7),x[a]=Math.round((c-b)/6048e5),x[a]},ja=function(a,b,c){var d,c=new Date(a,b,c,0,0,0),e=c.getDay();return c.setDate(c.getDate()-(e+6)%7+3),d=c.valueOf(),c.setMonth(0),c.setDate(4),Math.round((d-c.valueOf())/6048e5)+1},ka=function(a,b,c){if(!a||isNaN(a))return b;var d,e,f=a.getDate(),g=a.getDay(),h=a.getMonth(),j=a.getFullYear(),k=c?F:Z,l=String(b).split(T),l=Y(b,T),m=[],n={d:i(f),D:k.dayAbbrs[0==g?6:g-1],l:k.fullDays[0==g?6:g-1],j:f,N:0==g?7:g,w:g,W:ja(j,h,f),M:k.monthAbbrs[h],F:k.fullMonths[h],m:i(h+1),n:h+1,t:ha(h,j),y:String(j).substr(2,2),Y:j,S:["th","st","nd","rd"][f%10>3?0:(f%100-f%10!=10)*f%10]},o=l.length;for(e=0;e<o;e++)d=l[e],m.push(d in n?n[d]:d);return m.join("")},la=function(a,b){var c,d,e,f=!1,g=!1,h=!1,i=b.search(O)!=-1?1:0,j=b.search(P)!=-1?1:0,k=b.search(Q)!=-1?1:0,l=(new Date,Y(b,T)),a=""+a,m=l.length;a:for(c=0;c<m;c++)if(d=l[c],""!==d){if(0==a.length)break;switch(d){
// Dividers - be easy on them all i.e. accept them all when parsing...
case"/":case".":case" ":case"-":case",":case":":a=a.substr(1);break;
// DAY
case"d":
// Day of the month, 2 digits with leading zeros (01 - 31)
if(a.search(/^(3[01]|[12][0-9]|0[1-9])/)!=-1){f=a.substr(0,2),a=a.substr(2);break}return!1;case"j":// Day of the month without leading zeros (1 - 31)
if(a.search(/^(3[01]|[12][0-9]|[1-9])/)!=-1){f=+a.match(/^(3[01]|[12][0-9]|[1-9])/)[0],a=a.substr(a.match(/^(3[01]|[12][0-9]|[1-9])/)[0].length);break}return!1;case"D":// A textual representation of a day, three letters (Mon - Sun)
case"l":// A full textual representation of the day of the week (Monday - Sunday)
// Accept English & imported locales and both modifiers
e=Z.fullDays.concat(Z.dayAbbrs),F.imported&&(e=e.concat(F.fullDays).concat(F.dayAbbrs));for(var n=0;n<e.length;n++)if(new RegExp("^"+e[n],"i").test(a)){a=a.substr(e[n].length);continue a}break;case"N":// ISO-8601 numeric representation of the day of the week (added in PHP 5.1.0) 1 (for Monday) through 7 (for Sunday)
case"w":// Numeric representation of the day of the week 0 (for Sunday) through 6 (for Saturday)
a.search("N"==d?/^([1-7])/:/^([0-6])/)!=-1&&(a=a.substr(1));break;case"S":// English ordinal suffix for the day of the month, 2 characters: st, nd, rd or th
a.search(/^(st|nd|rd|th)/i)!=-1&&(a=a.substr(2));break;
// WEEK
case"W":// ISO-8601 week number of year, weeks starting on Monday (added in PHP 4.1.0): 1 - 53
a.search(/^([1-9]|[1234[0-9]|5[0-3])/)!=-1&&(a=a.substr(a.match(/^([1-9]|[1234[0-9]|5[0-3])/)[0].length));break;
// MONTH
case"M":// A short textual representation of a month, three letters
case"F":// A full textual representation of a month, such as January or March
// Accept English & imported locales and both modifiers
e=Z.fullMonths.concat(Z.monthAbbrs),F.imported&&(e=e.concat(F.fullMonths).concat(F.monthAbbrs));for(var n=0;n<e.length;n++)if(a.search(new RegExp("^"+e[n],"i"))!=-1){a=a.substr(e[n].length),g=(n+12)%12+1;continue a}return!1;case"m":if(// Numeric representation of a month, with leading zeros
e=/^(1[012]|0[1-9])/,a.search(e)!=-1){g=+a.substr(0,2),a=a.substr(2);break}return!1;case"n":if(// Numeric representation of a month, without leading zeros
// Accept either when parsing
e=/^(1[012]|[1-9])/,a.search(e)!=-1){g=+a.match(e)[0],a=a.substr(a.match(e)[0].length);break}return!1;case"t":// Number of days in the given month: 28 through 31
if(a.search(/2[89]|3[01]/)!=-1){a=a.substr(2);break}return!1;
// YEAR
case"Y":// A full numeric representation of a year, 4 digits
if(a.search(/^(\d{4})/)!=-1){h=a.substr(0,4),a=a.substr(4);break}return!1;case"y":// A two digit representation of a year
if(a.search(/^(0[0-9]|[1-9][0-9])/)!=-1){h=a.substr(0,2),h=+h<50?"20"+String(h):"19"+String(h),a=a.substr(2);break}return!1;default:a=a.substr(d.length)}}return!(i&&f===!1||j&&g===!1||k&&h===!1)&&(!(i&&j&&k&&+f>ha(+g-1,+h))&&{d:!!i&&+f,m:!!j&&+g,y:!!k&&+h})},ma=function(a){var b;if(a.parentNode&&"label"==a.parentNode.tagName.toLowerCase())b=a.parentNode;else
// loop through label array attempting to match each 'for' attribute to the id of the current element
for(var c=document.getElementsByTagName("label"),d=0;d<c.length;d++)
// Internet Explorer requires the htmlFor test
if(c[d].htmlFor&&c[d].htmlFor==a.id||c[d].getAttribute("for")==a.id){b=c[d];break}return b&&!b.id&&a.id&&(b.id=a.id+"_label"),b},na=function(){"object"==typeof window.fdLocale?F={titles:fdLocale.titles,fullMonths:fdLocale.fullMonths,monthAbbrs:fdLocale.monthAbbrs,fullDays:fdLocale.fullDays,dayAbbrs:fdLocale.dayAbbrs,firstDayOfWeek:"firstDayOfWeek"in fdLocale?fdLocale.firstDayOfWeek:0,rtl:"rtl"in fdLocale&&!!fdLocale.rtl,imported:!0}:F||(F=Z)},oa=function(){na();var a;for(a in w)w[a].created&&w[a].updateTable()},pa=function(a){return!(!a||!a.tagName||("input"!=a.tagName.toLowerCase()||"text"!=a.type&&"hidden"!=a.type)&&"select"!=a.tagName.toLowerCase())},qa=function(a){if(na(),null===A&&(A=ta()),a.formElements){a.id=a.id&&a.id in a.formElements?a.id:"",a.enabledDates=!1,a.disabledDates=!1;var b,c,d,e,f,g,h,j={d:0,m:0,y:0},k={},l=!1,m=0,n=0;for(e in a.formElements){if(f=document.getElementById(e),!pa(f)){if(r)throw"Element '"+e+"' is of the wrong type or does not exist within the DOM";return!1}if(!a.formElements[e].match(S)){if(r)throw"Element '"+e+"' has a date format that does not contain either a day (d|j), month (m|F|n) or year (y|Y) part: "+a.formElements[e];return!1}if(a.id||(a.id=e),k[e]="select"==f.tagName?f.selectedIndex||0:f.defaultValue,b={value:a.formElements[e]},b.d=b.value.search(O)!=-1,b.m=b.value.search(P)!=-1,b.y=b.value.search(Q)!=-1,b.d&&j.d++,b.m&&j.m++,b.y&&j.y++,"select"==f.tagName.toLowerCase()){
// If we have a selectList, then try to parse the higher and lower limits
var o=f.options;
// Check the yyyymmdd
if(b.d&&b.m&&b.y){for(l=!1,
// Dynamically calculate the available "enabled" dates
a.enabledDates={},a.disabledDates={},h=0;h<o.length;h++)g=la(o[h].value,b.value),g&&g.y&&g.m!==!1&&g.d&&(d=g.y+""+i(g.m)+i(g.d),l||(l=d),a.enabledDates[d]=1,(!m||+d<+m)&&(m=d),(!n||+d>+n)&&(n=d));
// Automatically set cursor to first available date (if no bespoke cursorDate was set);
!a.cursorDate&&l&&(a.cursorDate=l),a.disabledDates[m]=n}else if(b.m&&b.y){for(h=0;h<o.length;h++)g=la(o[h].value,b.value),g.y&&g.m!==!1&&(d=g.y+""+i(g.m),(!m||+d<+m)&&(m=d),(!n||+d>+n)&&(n=d));
// Round the min & max values to be used as rangeLow & rangeHigh
m+="01",n+=""+ha(+n.substr(4,2)-1,+n.substr(0,4))}else if(b.y){for(h=0;h<o.length;h++)g=la(o[h].value,b.value),g.y&&((!m||+g.y<+m)&&(m=g.y),(!n||+g.y>+n)&&(n=g.y));
// Round the min & max values to be used as rangeLow & rangeHigh
m+="0101",n+="1231"}}}if(1!=j.d||1!=j.m||1!=j.y){if(r)throw"Could not find all of the required date parts within the date format for element: "+f.id;return!1}a.rangeLow=p(a.rangeLow||!1),a.rangeHigh=p(a.rangeHigh||!1),a.cursorDate=p(a.cursorDate||!1),m&&(!a.rangeLow||+a.rangeLow<+m)&&(a.rangeLow=m),n&&(!a.rangeHigh||+a.rangeHigh>+n)&&(a.rangeHigh=n),c={formElements:a.formElements,
// default values
defaultVals:k,
// Form element id
id:a.id,
// Non popup datepicker required
staticPos:!(!a.staticPos&&!a.nopopup),
// Position static datepicker or popup datepicker's button
positioned:a.positioned&&document.getElementById(a.positioned)?a.positioned:"",
// Ranges stipulated in YYYYMMDD format
rangeLow:a.rangeLow&&String(a.rangeLow).search(U)!=-1?a.rangeLow:"",rangeHigh:a.rangeHigh&&String(a.rangeHigh).search(U)!=-1?a.rangeHigh:"",
// Status bar format
statusFormat:a.statusFormat||M,
// No fade in/out effect
noFadeEffect:!!a.staticPos||!!a.noFadeEffect,
// No drag functionality
dragDisabled:!(!G&&!a.staticPos)||!!a.dragDisabled,
// Bespoke tabindex for this datePicker (or its activation button)
bespokeTabIndex:a.bespokeTabindex&&"number"==typeof a.bespokeTabindex?parseInt(a.bespokeTabindex,10):0,
// Bespoke titles
bespokeTitles:a.bespokeTitles||y||{},
// Final opacity
finalOpacity:a.finalOpacity&&"number"==typeof a.finalOpacity&&a.finalOpacity>20&&a.finalOpacity<=100?parseInt(+a.finalOpacity,10):a.staticPos?100:z,
// Do we hide the form elements on datepicker creation
hideInput:!!a.hideInput,
// Do we hide the "today" button
noToday:!!a.noTodayButton,
// Do we show week numbers
showWeeks:!!a.showWeeks,
// Do we fill the entire grid with dates
fillGrid:!!a.fillGrid,
// Do we constrain selection of dates outside the current month
constrainSelection:!("constrainSelection"in a)||!!a.constrainSelection,
// The date to set the initial cursor to
cursorDate:a.cursorDate&&String(a.cursorDate).search(U)!=-1?a.cursorDate:"",
// Locate label to set the ARIA labelled-by property
labelledBy:ma(f),
// Have we been passed a describedBy to set the ARIA decribed-by property...
describedBy:a.describedBy&&document.getElementById(a.describedBy)?a.describedBy:t&&document.getElementById(t)?t:"",
// Callback functions
callbacks:a.callbackFunctions?a.callbackFunctions:{},
// Days of the week to highlight (normally the weekend)
highlightDays:a.highlightDays&&a.highlightDays.length&&7==a.highlightDays.length?a.highlightDays:[0,0,0,0,0,1,1],
// Days of the week to disable
disabledDays:a.disabledDays&&a.disabledDays.length&&7==a.disabledDays.length?a.disabledDays:[0,0,0,0,0,0,0],
// A bespoke class to give the datepicker
bespokeClass:a.bespokeClass?" "+a.bespokeClass:""},w[a.id]=new q(c),"disabledDates"in a&&a.disabledDates!==!1&&w[a.id].setDisabledDates(a.disabledDates),"enabledDates"in a&&a.enabledDates!==!1&&w[a.id].setEnabledDates(a.enabledDates),w[a.id].callback("create",w[a.id].createCbArgObj())}else if(r)throw"No form elements stipulated within initialisation parameters"},ra=function(a){return!!(a&&a in w)&&w[a].visible},sa=function(){var a;for(a in w)w.hasOwnProperty(a)&&w[a].changeHandler()},ta=function(){var a,b=["Webkit","Moz","ms","O"],c=document.createElement("div"),d=["WebkitTransition","transition","OTransition","MozTransition","msTransition"];for(a=0;a<d.length;a++)if(d[a]in c.style){B="webkitTransition"==d[a]||"OTransition"==d[a]?d[a]+"End":"transitionend";break}if(!B)return!1;if(c.style.animationName)return!0;for(var e=0;e<b.length;e++)if(void 0!==c.style[b[e]+"AnimationName"])return!0;return!1};
// Add oldie class if needed for IE < 9
return j(window,"unload",ca),j(window,"load",function(){setTimeout(sa,0)}),X&&c(document.documentElement,"oldie"),{
// General event functions...
addEvent:function(a,b,c){return j(a,b,c)},removeEvent:function(a,b,c){return k(a,b,c)},stopEvent:function(a){return l(a)},
// Show a single popup datepicker
show:function(a){return ba(a,!1)},
// Hide a popup datepicker
hide:function(a){return aa(a)},
// Create a new datepicker
createDatePicker:function(a){qa(a)},
// Destroy a datepicker (remove events and DOM nodes)
destroyDatePicker:function(a){da(a)},
// Check datePicker form elements exist, if not, destroy the datepicker
cleanUp:function(){$()},
// Pretty print a date object according to the format passed in
printFormattedDate:function(a,b,c){return ka(a,b,c)},
// Update the internal date using the form element value
setDateFromInput:function(a){return!!(a&&a in w)&&void w[a].setDateFromInput()},
// Set low and high date ranges
setRangeLow:function(a,b){return!!(a&&a in w)&&void w[a].setRangeLow(p(b))},setRangeHigh:function(a,b){return!!(a&&a in w)&&void w[a].setRangeHigh(p(b))},
// Set bespoke titles for a datepicker instance
setBespokeTitles:function(a,b){return!!(a&&a in w)&&void w[a].setBespokeTitles(b)},
// Add bespoke titles for a datepicker instance
addBespokeTitles:function(a,b){return!!(a&&a in w)&&void w[a].addBespokeTitles(b)},
// Attempt to parse a valid date from a date string using the passed in format
parseDateString:function(a,b){return la(a,b)},
// Change global configuration parameters
setGlobalOptions:function(a){f(a)},
// Forces the datepickers "selected" date
setSelectedDate:function(a,b){return!!(a&&a in w)&&void w[a].setSelectedDate(p(b))},
// Is the date valid for selection i.e. not outside ranges etc
dateValidForSelection:function(a,b){return!!(a&&a in w)&&w[a].canDateBeSelected(b)},
// Add disabled and enabled dates
addDisabledDates:function(a,b){return!!(a&&a in w)&&void w[a].addDisabledDates(b)},setDisabledDates:function(a,b){return!!(a&&a in w)&&void w[a].setDisabledDates(b)},addEnabledDates:function(a,b){return!!(a&&a in w)&&void w[a].addEnabledDates(b)},setEnabledDates:function(a,b){return!!(a&&a in w)&&void w[a].setEnabledDates(b)},
// Disable and enable the datepicker
disable:function(a){return!!(a&&a in w)&&void w[a].disableDatePicker()},enable:function(a){return!!(a&&a in w)&&void w[a].enableDatePicker()},
// Set the cursor date
setCursorDate:function(a,b){return!!(a&&a in w)&&void w[a].setCursorDate(p(b))},
// Whats the currently selected date
getSelectedDate:function(a){return!!(a&&a in w)&&w[a].returnSelectedDate()},
// Attempt to update the language (causes a redraw of all datepickers on the page)
loadLanguage:function(){oa()},
// Set the debug level i.e. throw errors or fail silently
setDebug:function(a){r=!!a},
// Converts Date Object to a YYYYMMDD formatted String
dateToYYYYMMDDStr:function(a){return p(a)}}}();